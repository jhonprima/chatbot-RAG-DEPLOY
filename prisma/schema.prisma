// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Model untuk tabel 'users'
model User {
  // CATATAN 1: ID diubah menjadi UUID agar konsisten dengan tabel chat_contents
  id            String        @id @default(uuid()) @db.Uuid
  name          String?       @db.VarChar(100)
  email         String        @unique @db.VarChar(100)
  password      String        @db.VarChar(100)
  created_at    DateTime?     @default(now()) @db.Timestamptz(6)
  updated_at    DateTime?     @updatedAt @db.Timestamptz(6)
  chat_contents ChatContent[] // Relasi ke tabel chat_contents
}

// Model untuk tabel 'messages'
model Message {
  id         Int       @id @default(autoincrement())
  // CATATAN 2: Sebaiknya ini adalah relasi ke tabel User, bukan hanya TEXT
  user       String    @db.Text
  chat_id    String    @db.Text
  title      String?   @db.Text
  content    String    @db.Text
  role       String?   @default("user") @db.Text
  created_at DateTime? @db.Timestamptz(6)
  updated_at DateTime? @db.Timestamptz(6)

  @@index([user])
  @@index([chat_id])
  @@index([created_at])
}

// Model untuk tabel 'chat_contents'
model ChatContent {
  id         Int       @id @default(autoincrement())
  user_id    String    @db.Uuid
  chat_id    String    @db.VarChar(100)
  messages   Json      @default("[]") @db.JsonB
  history    Json      @default("[]") @db.JsonB
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @updatedAt @db.Timestamptz(6)

  // Relasi ke tabel User
  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, chat_id])
}